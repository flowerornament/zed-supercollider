title: "Code Review – SuperCollider Zed Extension"
created: 2026-01-05
updated: 2026-01-07
purpose: "Condensed review takeaways that still apply"
scope: "Launcher, extension entry, vendored quark, language config"
---

# Code Review – SuperCollider Zed Extension

## Still-relevant findings (ordered)
- Process safety: launcher kills any `sclang` on startup and ignores LSP shutdown/exit; switch to targeted shutdown of the child only.
- Dev launcher selection: extension picks local `target/release/sc_launcher` whenever `Cargo.toml` exists; guard on binary existence or fall back to settings/PATH.
- Capability drift: advertising `serverStatus`, document symbols, formatting, etc. despite partial/stubbed support; align capabilities with real behavior.
- Config guardrails: no validation for `languages/SuperCollider/config.toml` (banned fields, missing `word_characters`).
- Logging defaults: noisy packet logs and `/tmp` writes without level gating; HTTP eval is fire-and-forget with permissive CORS.
- Crash: references provider can throw “Non Boolean in test” when `includeDeclaration` is malformed; coerce to Bool.
- Probe/output safety: JSON probe response not escaped via `serde_json`; tasks contain hardcoded paths/global `pkill`.
- Tests/CI: none for launcher or config validation; needs at least smoke tests and a stub CI.
- Minor correctness: uses `out.status.unwrap_or(-1) == 0` instead of `.success()` in `src/lib.rs`; selection-range/doc-symbol providers return empty dicts instead of omitting.

## Quick win list
- Remove `serverStatus` capability/notification; advertise only working providers.
- Guard dev launcher selection on binary existence; otherwise honor settings/PATH.
- Fix `includeDeclaration` Bool coercion in `FindReferencesProvider.sc`.
- Tame default logging; gate verbose logs behind env.
- Add `scripts/validate-config.sh` + CI stub; enforce minimal config and add `word_characters = ["a-zA-Z0-9_?"]`.
- Use `serde_json` for probe output; clean `.zed/tasks.json` (no absolute paths/global pkill).
- Use `.success()` for command exit checks; align shutdown flow to avoid orphaned/killed user processes.
