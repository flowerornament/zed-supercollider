## What we were doing
- Debugging LSP in Zed SuperCollider extension (vendored LanguageServer quark).
- Hover fixed: returns symbol + first block comment from class file.
- Find References fallback fixed for SinOscFB; built-ins (MouseX, .postln) still odd.
- Outline still empty because Zed is not sending `textDocument/documentSymbol`.

## Current status
- Hover: working.
- Go-to-definition: working.
- References: working for SinOscFB; built-ins may open class docs but sometimes errors (“Non Boolean in test”) if the installed quark is stale.
- Logs: see `/tmp/sclang_post.log` for `REFS DEBUG` lines; errors “Non Boolean in test” indicate the references provider fallback logic.
- Zed still not issuing documentSymbol requests.

## Recent changes (repo)
- `Providers/HoverProvider.sc`: uses `stripWhiteSpace`, reads class doc block; debug logs.
- `Providers/FindReferencesProvider.sc`: fallback to class doc; fixed block comment range detection (startLine/endLine). Repo version no longer prepends decl when refs exist. If no refs/defs, returns class doc range.
- Launcher filters some noisy capability logs.
- `.ai/context.md` updated with state and warnings.

## Gotchas
- Installed quark may be stale. If references keep failing or show “Non Boolean in test”, ensure the installed LanguageServer copy matches the repo (`server/quark/LanguageServer.quark/Providers/FindReferencesProvider.sc`). User prefers we do NOT overwrite their installed quark ever.
- Zed outline won’t work until the client sends `textDocument/documentSymbol`; nothing on server side yet.
- Keep config.toml minimal (see anti-patterns in .ai/context.md).

## Next steps to continue
1) Rebuild/reload the extension in Zed so sclang picks up the repo quark.
2) Run “Find all references” on MouseX / .postln and inspect `/tmp/sclang_post.log` `REFS DEBUG` and any errors. If errors persist, adjust references fallback (in repo only) and ask user before copying to installed quark.
3) Investigate why Zed never sends `textDocument/documentSymbol`; if it starts appearing, implement document symbols in provider (currently just logs if called).
4) Once stable, trim debug logging.

## Quick commands
```bash
grep -i \"refs debug\\|error\" /tmp/sclang_post.log | tail -n 40
grep -i \"documentSymbol\" /tmp/sc_launcher_stdin.log
```
