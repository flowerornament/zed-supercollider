---
title: "LSP Debugging and Status"
created: 2026-01-05
updated: 2026-01-06
priority: P0
status: done
owners: [team]
purpose: "Working notes for LSP debugging sessions, current status, and next steps"
note: "See 2026-01-05-execution-plan.md for master roadmap"
---

## What we were doing
- Debugging LSP in Zed SuperCollider extension (vendored LanguageServer quark).
- Hover fixed: returns symbol + first block comment from class file.
- Find References fallback fixed for SinOscFB; built-ins (MouseX, .postln) still odd.
- Outline still empty because Zed is not sending `textDocument/documentSymbol`.

## Status Log
- 2026-01-05: Status set to active; monitoring references fallback and documentSymbol behavior.
- 2026-01-06: Marked done; hover/definition/references are stable enough for current scope and Zed is not sending documentSymbol.

## Current status
- Hover: working.
- Go-to-definition: working.
- References: working for SinOscFB; built-ins may open class docs but sometimes errors (“Non Boolean in test”) if the installed quark is stale.
- Logs: see `/tmp/sclang_post.log` for `REFS DEBUG` lines; errors “Non Boolean in test” indicate the references provider fallback logic.
- Zed still not issuing documentSymbol requests.

## Recent changes (repo)
- `Providers/HoverProvider.sc`: uses `stripWhiteSpace`, reads class doc block; debug logs.
- `Providers/FindReferencesProvider.sc`: fallback to class doc; fixed block comment range detection (startLine/endLine). Repo version no longer prepends decl when refs exist. If no refs/defs, returns class doc range.
- Launcher filters some noisy capability logs.
- `.ai/context.md` updated with state and warnings.

## Gotchas
- Installed quark may be stale. If references keep failing or show “Non Boolean in test”, ensure the installed LanguageServer copy matches the repo (`server/quark/LanguageServer.quark/Providers/FindReferencesProvider.sc`). User prefers we do NOT overwrite their installed quark ever.
- Zed outline won’t work until the client sends `textDocument/documentSymbol`; nothing on server side yet.
- Keep config.toml minimal (see anti-patterns in .ai/context.md).
